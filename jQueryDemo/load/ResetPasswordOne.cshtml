
@{
    ViewBag.Title = "找回密码";
    Layout = "~/Views/Shared/_Navigater01.cshtml";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/commom.css" rel="stylesheet" />
    <link href="../../Content/css/register.css" rel="stylesheet" />
    <script src="~/Scripts/js/jquery-1.12.2.min.js"></script>
    <script src="~/Scripts/js/bootstrap.min.js"></script>


</head>
<body>

    @*<div style="width:100%;height:100%;padding-bottom:158px">
        <section class="layout">
            <article class="regNav">
                <a href="/Home" style="color:#999"> 首页</a><span> > </span><span class="regAccount">密码找回</span>
            </article>
        </section>
        <section class="layout">
            <article class="regBox">
                <section class="regBoxTitle">
                    <ul class="regBoxUl">
                        <li><span class="regWidth"><span class="regPhone"><img src="../../Content/img/register/regPhoneActive.png" /></span><span>验证手机</span></span><span class="regLine"></span></li>
                        <li><span class="regWidth"><span class="regPsd"><img src="../../Content/img/register/regPsd.png" /></span><span>设置密码</span></span><span class="regLine"></span></li>
                        <li><span><span class="regSuccess"><img src="../../Content/img/register/regSuccess.png" /></span><span>修改成功</span></span></li>
                    </ul>

                </section>
                <div class="regBoxLoad">
                    <section class="phoneBox">
                        <article class="phoneNum">手机号</article>
                        <input class="phoneInput" type="tel" maxlength="11" onfocus="this.placeholder = ''" onkeyup="CheckValue()" name="phoneInput" onblur="ValidateMobile()" id="txtMobile" placeholder="请输入您的手机号码">
                        <span class="phoneClear"><img onclick="$('#txtMobile').val('');" src="../../Content/img/register/clear.png" /></span>
                    </section>
                    <span class="phoneError" id="spMobileError" style="display:none"><img src="../../Content/img/register/error.png" /><span id="spMError"></span></span>

                    <section class="phoneBox imgBox">
                        <article class="phoneNum imgText" for="phoneInput">图形验证</article>
                        <input class="imgInput" maxlength="4" onfocus="this.placeholder = ''" onkeyup="CheckValue()" onblur="ValidateCaptca()" id="txtCaptcha" name="phoneInput" placeholder="请输入验证码">
                        <span class="imgImg"><img id="captca_img" alt="验证码" src="/Account/Captcha/?name=login_captcha" width="91" height="32" style="cursor: pointer;" onclick="this.src = '/Account/Captcha/?name=login_captcha&time=' + Math.random();" /></span>
                      
                    </section>
                    <span class="imgError" id="spCaptcaError" style="display:none"><img src="../../Content/img/register/error.png" /><span id="spCError"></span></span>

                    <a href="javascript:void(0)" id="btnNext" style="background-color:#eee" class="setOne">下一步</a>
                  
                </div>
            </article>
        </section>

    </div>*@
    <div style="width:100%;height:100%;padding-bottom:158px">
        <section class="layout">
            <article class="regNav">
                <a href="/Home" style="color:#999"> 首页</a><span> > </span><span class="regAccount">密码找回</span>
            </article>
        </section>
        <section class="layout">
            <article class="regBox">
                <section class="regBoxTitle">
                    <ul class="regBoxUl">
                        <li><span class="regWidth"><span class="regPhone"><img src="../../Content/img/register/regPhoneActive.svg" /></span><span>验证手机</span></span><span class="regLine"></span></li>
                        <li><span class="regWidth"><i class="of of-step2"></i><span>设置密码</span></span><span class="regLine"></span></li>
                        <li><span><span class="regSuccess"><i class="of of-correct"></i></span><span>修改成功</span></span></li>
                    </ul>
                   
                </section>
                <div class="regBoxLoad">
                    <section class="phoneBox">
                        <article class="phoneNum">手机号</article>
                        <input class="phoneInput" type="tel" maxlength="11" onfocus="this.placeholder = ''" name="phoneInput" onblur="ValidateMobile()" id="txtMobile" placeholder="请输入您的手机号码">
                        <span class="phoneClear"><img class="numClear" @*onclick="$('#txtMobile').val('');"*@ src="../../Content/img/register/clear.svg" /></span>
                    </section>
                    <span class="phoneError" id="spMobileError" style="display:none"><img src="../../Content/img/register/error.svg" /><span id="spMError"></span></span>

                    <section class="phoneBox imgBox">
                        <article class="phoneNum imgText" for="phoneInput">图形验证</article>
                        <input class="imgInput" maxlength="4" onfocus="this.placeholder = ''" onblur="ValidateCaptca()" id="txtCaptcha" name="phoneInput" placeholder="请输入验证码">
                        <span class="imgImg"><img id="captca_img" alt="验证码" src="/Account/Captcha/?name=login_captcha" width="70" height="36" style="cursor: pointer;border-radius:3px;" onclick="this.src = '/Account/Captcha/?name=login_captcha&time=' + Math.random();" /></span>

                    </section>
                    <span class="imgError" id="spCaptcaError" style="display:none"><img src="../../Content/img/register/error.svg" /><span id="spCError"></span></span>

                  
                    <button href="javascript:void(0)" id="btnNext" class="setOne btn-normal">下一步</button>
                    @*<section class="goLoad">已有账号？<a href="/Account/Login">去登录</a></section>*@
                </div>
            </article>
        </section>

    </div>

</body>
</html>

<script type="text/javascript">

    $(document).ready(function () {
        $("#btnNext").click(function () {
                RegisterTwo();            
        });

    });


    function CheckValue()
    {
        var mobile = $("#txtMobile").val().trim();
        var txtCaptca = $("#txtCaptcha").val().trim();
        if (mobile.length > 0 && txtCaptca.length > 0) {
            $("#btnNext").css("background-color", "#f36200");
            return true;
        }
        else {
            $("#btnNext").css("background-color", "#eee");
            return false;
        }

    }

    function ValidateMobile() {
        var mobile = $("#txtMobile").val().trim();
        var reg = /^1(3|4|5|7|8)\d{9}$/;
        if (mobile.length == 0) {
            $("#spMobileError").show();
            $("#spMError").text("请输入手机号码");
            $("#txtMobile").addClass("borderColor");
            return false;
        }
        if (!reg.test(mobile)) {
            $("#spMobileError").show();
            $("#spMError").text("手机号码格式不正确");
            $("#txtMobile").addClass("borderColor");
            return false;
        }
        $("#spMobileError").hide();
        $("#spMError").text("");
        $("#txtMobile").removeClass("borderColor");
        return true;

    }

    function ValidateCaptca() {
        var txtCaptca = $("#txtCaptcha").val().trim();
        if (txtCaptca.length == 0) {
            $("#spCaptcaError").show();
            $("#spCError").text("请输入验证码");
            $("#txtCaptcha").addClass("borderColor");
            return false;
        }
        if (txtCaptca.length > 0 && txtCaptca.length < 4)
        {
            $("#spCaptcaError").show();
            $("#spCError").text("验证码不正确");
            $("#txtCaptcha").addClass("borderColor");
            return false;
        }
        $("#spCaptcaError").hide();
        $("#spCError").text("");
        $("#txtCaptcha").removeClass("borderColor");
        return true;
    }

    function RegisterTwo() {
        if (ValidateMobile() == true && ValidateCaptca() == true) {
            var mobile = $("#txtMobile").val().trim();
            var captca = $("#txtCaptcha").val().trim();
            $.post("/Account/ValidateMobileCaptca", { mobile: mobile, captca: captca }, function (data) {
                if (data == "1") {
                    $("#spCaptcaError").show();
                    $("#spCError").text("验证码不正确");
                    $('#captca_img').attr('src', '/Account/Captcha/?name=login_captcha&time=' + Math.random());
                    $("#txtCaptcha").addClass("borderColor");
                    return false;
                }
                else if (data == "0") {
                    $("#spMobileError").show();
                    $("#spMError").text("该手机号码尚未注册");
                    $("#txtMobile").addClass("borderColor");
                    return true;
                }
                else {
                    window.location.href = "/Account/ResetPasswordTwo/" + mobile;
                }
            });

        }

    }







</script>
